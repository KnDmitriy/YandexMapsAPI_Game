<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Вход</title>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
  <link rel="stylesheet" href="style_login.css">
</head>
<body>
  
  
  <form id="signin-form">
    <h1>Вход</h1>
    <h8>У вас нет аккаунта? <a href="auth.html">Зарегистрироваться</a><h8>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <div class="information">
      <strong id="info"> 
  
      </strong> 
    </div>
    <button type="submit">Войти</button>
    <button id="reset-password-button" onclick='
    auth.onAuthStateChanged((user) => {
      
      if (!user) {
        // User is signed in
        resetPassword(document.getElementById("email").value);
      } else {
        print_text("Вы уже вошли в свой аккаунт.")
      }
    });
    
    
    '>Сбросить пароль</button>
  </form>
  <br>
  <h8><a href="index.html">Вернуться к приложению</a></h8>

  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "{{FIREBASE_API_KEY}}",
      authDomain: "{{FIREBASE_AUTH_DOMAIN}}",
      projectId: "{{FIREBASE_PROJECT_ID}}",
      storageBucket: "{{FIREBASE_STORAGE_BUCKET}}",
      messagingSenderId: "{{FIREBASE_MESSAGING_SENDER_ID}}",
      appId: "{{FIREBASE_APP_ID}}",
      measurementId: "{{FIREBASE_MEASUREMENT_ID}}"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    var delay = 0; // Время задержки между печатанием символов в милисекндах.
    elem_info = document.getElementById("info"); // id элемента для вывода результата    

    console.log(elem_info)

    var print_text = function(text, elem, delay) {
        if(text.length > 0) {
            elem.innerHTML = text;
            
        }
    }

    var replace_text = function(elem) {
        elem.innerHTML = ''
    }

    document.getElementById('signin-form').addEventListener('submit', (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      replace_text(elem_info)
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            const user = userCredential.user;
            console.log('User loged in successfuly')
            print_text('Вход произведен успешно.', elem_info, delay)
        }).catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            console.log('Error! Email or password is invalid.')
            print_text('Неверный логин или пароль ', elem_info, delay)
        })
      
    });

    // Функция для сброса пароля
    function resetPassword(email) {
      auth.sendPasswordResetEmail(email).then(() => {
        // Сообщение об успешной отправке
        //alert('Email для сброса пароля отправлен!');
        print_text('Email для сброса пароля отправлен!', elem_info, delay)
      }).catch((error) => {
        // Обработка ошибок
        console.error('Ошибка при сбросе пароля:', error);
        //alert('Ошибка при сбросе пароля: ' + error.message);
        print_text('Ошибка при сбросе пароля: ' + error.message, elem_info, delay)
      });
    }

    // Пример использования функции
    document.getElementById('reset-password-button').addEventListener('click', () => {
      const email = document.getElementById('email-input').value;
      resetPassword(email);
    });

    
  </script>
</body>
</html>